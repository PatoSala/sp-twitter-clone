<!DOCTYPE html>
<html>

<head>
  <link rel="icon" href="../images/favicon.png">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>loading</title>
  <link rel="stylesheet" href="../styles/pageContent.css">
  <link rel="stylesheet" href="../styles/header.css">
  <link rel="stylesheet" href="../styles/tweetsList.css"/>
  <link rel="stylesheet" href="../styles/profileInfo.css">
  <link rel="stylesheet" href="../styles/navLinks.css"/>
  <link rel="stylesheet" href="../styles/searchBar.css">
  <link rel="stylesheet" href="../styles/sideContainers.css">
  <link rel="stylesheet" href="../styles/main.css">
  <script src="https://kit.fontawesome.com/a7f33ed485.js" crossorigin="anonymous"></script>
</head>

<body>

    <dialog class="new-tweet-dialog">
        <div class="dialog-header">
            <div class="close-dialog-btn" onclick="closeNewTweetDialog()">
                <i class="fa-solid fa-xmark fa-lg"></i>
            </div>
        </div>

        <div class="compose-new-twitt-container">
                <div class="dialog-profile-bubble">
                </div>
                <textarea class="text-field" placeholder="En que estás pensando?"></textarea>
        </div>

        <div class="dialog-footer">
            <button type="button" class="post-tweet-btn" onclick="createTweet()">Publicar</button>
        </div>
    </dialog>

  <div class="side-containers left">

    <div class="nav-links">
        <a href="../index.html">
            <div class="list-item-container">
                <i class="fa-brands fa-twitter fa-xl" style="color: rgb(29, 155, 240)"></i>
            </div>
        </a>
    
        <a href="../index.html">
            <div class="list-item-container">
                <i class="fa-solid fa-hashtag fa-lg"></i>
                <p class="link-text">Inicio</p>
            </div>
        </a>
    
        <div class="list-item-container" onclick="navigateToProfile()">
            <i class="fa-regular fa-user fa-lg"></i>
            <p class="link-text">Perfil</p>
        </div>

        <a href="">
            <div class="list-item-container">
                <i class="fa-regular fa-bookmark fa-xl"></i>
                <p class="link-text">Guardados</p>
            </div>
        </a>

        <div class="list-item-container" onclick="logOut()">
            <i class="fa-solid fa-arrow-right-from-bracket fa-rotate-180 fa-lg"></i>
            <p class="link-text">Cerrar Sesión</p>
        </div>

        <div class="list-item-container">
            <i class="fa-solid fa-arrow-right-to-bracket fa-lg"></i>
            <p class="link-text">Iniciar Sesion</p>
        </div>
    
        <div class="list-item-container" style="background-color: rgb(29, 155, 240); color: white" onclick="openNewTweetDialog()">
            <i class="fa-solid fa-feather-pointed fa-lg"></i>
            <p class="link-text">Twittear</p>
        </div>
    </div>
    
  </div>

  <div class="page-content">

    <div class="header">
        <div class="arrow-container">
            <a href="../index.html">
                <i class="fa-solid fa-arrow-left fa-sm"></i>
            </a>
        </div>
        <div class="header-content">
            <h1></h1>
            <span></span>
        </div>
    </div>

    <div style="height: 50px"></div>

    <div class="profile-info-container">
        <div class="cover-photo-container"></div>
        <div class="profile-picture-container"></div>

        <div class="profile-buttons">
            <span class="follow-button">Seguir</span>
        </div>

        <div class="profile-data">
            <div class="profile-username">
                <h2></h2>
                <span class="twitter-profile-check"></span>
            </div>
            <p class="profile-bio"></p>
            <div class="following-followers-container">
                <span></span>
                <span></span>
            </div>
        </div>
    </div>

    <ul class="profile-sections">
        <li>
            Tweets
        </li>
    </ul>


    <div class="tweets-list">

        <div class="spinner">
            <i class="fa-solid fa-circle-notch fa-spin fa-xl" style="color: rgb(29, 155, 240)"></i>
        </div>
    </div>

  </div>

  <div class="side-containers right">
    <div class="search-bar-container">
        <input type="text" placeholder="Buscar en Twitter" class="search-input"/>
    </div>
</div>

  <script src="../scripts/apiKey.js"></script>
  <script src="../scripts/session.js"></script>

  <script src="../scripts/navBarLinks.js"></script>

  <script src="../scripts/fecthUserData.js"></script>
  <script src="../scripts/createTweet.js"></script>

  <script src="../scripts/tweetItemComponent.js"></script>
  <script src="../scripts/fetchAllUsers.js"></script>
  <script src="../scripts/fetchTweets.js"></script>
  <script src="../scripts/likeTweet.js"></script>
  <script src="../scripts/fetchLikes.js"></script>
  <script src="../scripts/renderTweets.js"></script>


  <script>
    let queryString = location.search;
    let params = new URLSearchParams(queryString);
    let userId = params.get("userId");

    if (session !== null && userId === session.user_id) {
        document.querySelector('.follow-button').style.display = 'none';
    }

    window.addEventListener("load", async e => {
        let userData = await fetchUserData(userId);
        console.log(userData);

        if (userData.length > 0) {
            document.querySelector('h1').innerHTML = userData[0].username;
            document.querySelector('.profile-picture-container').innerHTML = `<img src="${userData[0].avatar_url}" width="100px"/>`
            document.querySelector('h2').innerHTML = userData[0].username;
            document.querySelector('title').innerText = userData[0].username;
            if (userData[0].verified) {
                document.querySelector('.twitter-profile-check').innerHTML = `<svg style="width: 20px" class="twitter-check-sm" viewBox="0 0 22 22" aria-label="Cuenta verificada" role="img" data-testid="icon-verified"><g><path fill="rgb(29, 155, 240)" d="M20.396 11c-.018-.646-.215-1.275-.57-1.816-.354-.54-.852-.972-1.438-1.246.223-.607.27-1.264.14-1.897-.131-.634-.437-1.218-.882-1.687-.47-.445-1.053-.75-1.687-.882-.633-.13-1.29-.083-1.897.14-.273-.587-.704-1.086-1.245-1.44S11.647 1.62 11 1.604c-.646.017-1.273.213-1.813.568s-.969.854-1.24 1.44c-.608-.223-1.267-.272-1.902-.14-.635.13-1.22.436-1.69.882-.445.47-.749 1.055-.878 1.688-.13.633-.08 1.29.144 1.896-.587.274-1.087.705-1.443 1.245-.356.54-.555 1.17-.574 1.817.02.647.218 1.276.574 1.817.356.54.856.972 1.443 1.245-.224.606-.274 1.263-.144 1.896.13.634.433 1.218.877 1.688.47.443 1.054.747 1.687.878.633.132 1.29.084 1.897-.136.274.586.705 1.084 1.246 1.439.54.354 1.17.551 1.816.569.647-.016 1.276-.213 1.817-.567s.972-.854 1.245-1.44c.604.239 1.266.296 1.903.164.636-.132 1.22-.447 1.68-.907.46-.46.776-1.044.908-1.681s.075-1.299-.165-1.903c.586-.274 1.084-.705 1.439-1.246.354-.54.551-1.17.569-1.816zM9.662 14.85l-3.429-3.428 1.293-1.302 2.072 2.072 4.4-4.794 1.347 1.246z"></path></g></svg>`
            }
            document.querySelector('.following-followers-container').children[0].innerText = `${userData[0].following_count} Siguiendo`
            document.querySelector('.following-followers-container').children[1].innerText = `${userData[0].followers_count} Seguidores`
        }

        await fetchAllUsers();
        await fetchTweets();
        document.querySelector('.header-content').children[1].innerText = `${tweets.length} Tweets`
        await fetchLikes();
        renderTweets(tweets, users);
    })
  </script>
  <!--
  This script places a badge on your repl's full-browser view back to your repl's cover
  page. Try various colors for the theme: dark, light, red, orange, yellow, lime, green,
  teal, blue, blurple, magenta, pink!
  -->
</body>

</html>